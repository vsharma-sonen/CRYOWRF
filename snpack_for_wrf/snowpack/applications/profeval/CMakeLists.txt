INCLUDE_DIRECTORIES("${PROJECT_SOURCE_DIR}")
IF(COMMAND cmake_policy)
	CMAKE_POLICY(SET CMP0003 NEW)
ENDIF(COMMAND cmake_policy)

SET(profeval_sources
 	ProfEval.cc
#	readCaaML.cc
# 	writeCaaML.cc
)

SET(SN_LINKS "snowpack")
LINK_DIRECTORIES(${PROJECT_SOURCE_DIR}/lib)

FIND_PACKAGE(MeteoIO REQUIRED)
INCLUDE_DIRECTORIES(${INCLUDE_DIRECTORIES} ${METEOIO_INCLUDE_DIR})

IF(APPLE)
	#this is necessary for GUI exceptions
	LIST(APPEND SN_LINKS "-framework CoreServices")
ENDIF(APPLE)

INCLUDE("${CMAKE_MODULE_PATH}/BuildVersion.cmake")
BuildVersion()

IF(UNIX)
	LIST(APPEND SN_LINKS "dl;pthread")
ENDIF(UNIX)

#Prepare executable
SET(BINARY "profeval.app")
ADD_EXECUTABLE(${BINARY} ${profeval_sources})

TARGET_LINK_LIBRARIES(${BINARY} ${SN_LINKS})

SET_TARGET_PROPERTIES(${BINARY} PROPERTIES
	RUNTIME_OUTPUT_DIRECTORY "${PROJECT_SOURCE_DIR}/bin"
	CLEAN_DIRECT_OUTPUT 1
	OUTPUT_NAME "profeval"
)

INSTALL(TARGETS ${BINARY}
	RUNTIME DESTINATION bin
	COMPONENT exe
)